# 寻商问道 - TODO

## 视觉与品牌
- [x] 生成简笔画风格Logo（寻商问道）
- [x] 更新app.config.ts应用名称为"寻商问道"
- [x] 配置品牌主题色（靛蓝#3B5BDB）
- [x] 复制Logo到所有必要位置（icon/splash/favicon/android）

## 数据库与后端
- [x] 数据库Schema：用户表、商家表、预约表、AI对话表、商机分析表
- [x] 运行数据库迁移
- [x] 后端路由：手机号验证码登录/注册
- [x] 后端路由：商家CRUD（注册、搜索、详情）
- [x] 后端路由：预约管理（创建、查询、更新状态）
- [x] 后端路由：AI对话（QwenMax联网搜索）
- [x] 后端路由：每日商机分析
- [x] 后端路由：身份切换（顾客↔商家）
- [x] 后端路由：商家在线搜索（AI联网）
- [x] 后端路由：行业实时分析

## QwenMax AI引擎
- [x] 创建server/qwen.ts，接入通义千问API
- [x] 启用web_search工具（search_strategy: pro深度搜索）
- [x] AI对话时实时联网：商家信息、价格行情、用户评价
- [x] 每日商机分析时联网：行业趋势、竞争对手、市场动态
- [x] QwenMax API Key配置完成

## 手机号登录注册
- [x] 欢迎/启动页（动画效果）
- [x] 手机号输入（+86前缀）
- [x] 验证码发送与60秒倒计时
- [x] 开发模式验证码提示
- [x] 新用户资料完善（昵称+身份选择）
- [x] 顾客/商家身份选择（注册时）
- [x] JWT Token持久化存储

## 身份自由切换
- [x] 个人中心顶部"切换身份"按钮
- [x] 顾客↔商家一键切换
- [x] 切换后AI助手自动调整服务模式
- [x] 切换同步到服务器

## 核心前端页面
- [x] 首页：AI入口卡片、今日商机、推荐商家/客户列表、分类筛选
- [x] AI对话页：道道AI助手、快速提问、Manus兜底入口
- [x] 搜索页：本地搜索+AI联网搜索双模式、行业分析入口
- [x] 预约管理页：预约列表、状态管理
- [x] 个人中心页：用户信息、统计数据、功能菜单、身份切换卡片
- [x] 商家详情页：商家信息、AI语音通话模拟、预约入口
- [x] 预约创建页：时间选择、需求填写

## Manus兜底入口
- [x] AI对话页顶部"找Manus"按钮（跳转manus.im）
- [x] AI回复中自动识别复杂问题，显示"找Manus"卡片
- [x] 个人中心"找Manus解决复杂问题"菜单项

## 每日商机分析
- [x] 数据库：商机分析记录表
- [x] 后端：AI生成商机分析（QwenMax联网）
- [x] 前端：首页展示今日商机卡片
- [x] 顾客版：推荐商家+行动建议
- [x] 商家版：潜在客户分析+市场趋势

## AI全网匹配有缘人（新增）
- [x] 后端：AI全网匹配引擎（QwenMax联网搜索+智能评分）
- [x] 后端：商家找用户接口（根据商家业务类型全网匹配潜在客户）
- [x] 后端：用户找商家接口（根据用户需求全网匹配最合适商家）
- [x] 后端：双向匹配推荐算法（匹配度分数+匹配理由+客户画像）
- [x] 前端：新增“匹配”底部导航标签页（独立页面）
- [x] 前端：匹配结果展示页（带匹配度分数和理由）
- [x] 前端：一键预约/联系匹配到的商家/用户

## 待完善
- [x] 部署到阿里云服务器（47.104.194.82）- PM2进程online，端口4000运行正常
- [ ] 真实短信验证码接入（当前为开发模式）
- [ ] AI语音通话（当前为模拟，需接入TTS服务）
- [ ] 推送通知（预约提醒）
- [ ] 商家资料完善页面
- [ ] 数据库自动备份
- [ ] HTTPS配置

## AI深度需求理解 + 用户画像记忆（新增）
- [x] 后端：drizzle schema添加userProfiles表（手机号+画像JSON+历史需求）
- [x] 后端：drizzle schema添加matchSessions表（多轮对话会话存储）
- [x] 后端：qwen.ts添加qwenDeepNeedChat（AI多轮追问引擎）
- [x] 后端：qwen.ts添加qwenPreciseMatch（信息充足后精准匹配）
- [x] 后端：qwen.ts添加qwenBuildProfile（构建/更新用户画像）
- [x] 后端：routers.ts添加match.chat多轮对话路由（公开接口，无需登录）
- [x] 后端：routers.ts添加match.getProfile路由（查询用户画像）
- [x] 前端：首页重设计为ChatGPT对话式界面（道道AI顾问）
- [x] 前端：我的页面重设计为用户画像展示（无需登录）
- [x] 去掉登录注册流程，直接用手机号进入

## Qwen语音模型集成（新增）
- [ ] 后端：接入通义千问CosyVoice TTS语音合成API
- [ ] 后端：添加tts路由，将AI文字回复转为语音流
- [ ] 前端：道道AI对话界面每条AI消息添加🔊播放按钮
- [ ] 前端：集成expo-av音频播放，支持流式语音播放
- [ ] 前端：语音播放状态管理（播放中/暂停/停止）

## 最终版本修复（2026-02-21）
- [x] 修复match.tsx重定向路径错误
- [x] 添加后端appointment.listByPhone公开接口
- [x] 修复api.ts中tRPC请求格式（input包装为{json:input}）
- [x] 修复api.ts响应解析（result.data.json）
- [x] TypeScript 0错误验证通过
- [x] 所有核心接口验证通过（health/match.chat/appointment.listByPhone/match.getProfile）

## 商家入驻 + AI牵线搭桥（新增）
- [ ] 后端：merchant.register公开接口（无需登录，AI分析并录入匹配库）
- [ ] 后端：merchant.list公开接口（展示所有已入驻商家）
- [ ] 后端：qwenAnalyzeMerchant函数（AI提取商家标签/服务范围/目标客群）
- [ ] 前端：发现页"我要入驻"按钮
- [ ] 前端：商家入驻表单（业务类型/服务范围/联系方式/所在地区）
- [ ] 前端：入驻成功后AI生成商家名片展示
- [ ] 前端：道道AI对话中主动推送匹配商家/用户"有缘人"卡片
- [ ] 前端：有缘人卡片支持一键拨打/复制联系方式
